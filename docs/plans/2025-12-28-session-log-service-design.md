# SessionLogService ì„¤ê³„

> ì‘ì„±ì¼: 2025-12-28
> ëª©í‘œ: ìŠ¤í¬ë¦°ìƒ·ê³¼ ë””ë²„ê¹… ë¡œê·¸ì˜ ì²´ê³„ì  ê´€ë¦¬

---

## 1. ê°œìš”

### í˜„ì¬ ë¬¸ì œì 
- ìŠ¤í¬ë¦°ìƒ· íŒŒì¼ëª…ì— ì‘ì—… ìœ í˜•(pause/resume) êµ¬ë¶„ ì—†ìŒ
- ìŠ¤í¬ë¦°ìƒ· ì €ì¥ ìœ„ì¹˜ ë¶„ì‚°
- ì–´ë–¤ ë‹¨ê³„ì—ì„œ ì°íŒ ê±´ì§€ ì•Œ ìˆ˜ ì—†ìŒ
- ë¡œê·¸ì™€ ìŠ¤í¬ë¦°ìƒ· ì—°ê²° ì—†ìŒ

### í•´ê²° ë°©ì•ˆ
- í´ë” êµ¬ì¡°ë¡œ ì²´ê³„ì  ë¶„ë¥˜: ë‚ ì§œ/ê³„ì •/ì‹œê°„_ì‘ì—…ì¢…ë¥˜/ë‹¨ê³„
- log.txt + meta.jsonìœ¼ë¡œ ì»¨í…ìŠ¤íŠ¸ ë³´ì¡´
- SessionLogService ê³µí†µ ì„œë¹„ìŠ¤ë¡œ ì¼ì›í™”
- 3ì¼ ìë™ ì •ë¦¬ + ì „ì²´ ë¹„ìš°ê¸° ê¸°ëŠ¥

---

## 2. í´ë” êµ¬ì¡°

```
logs/screenshots/
â”œâ”€â”€ 2025-12-28/                          # ë‚ ì§œ
â”‚   â”œâ”€â”€ john@gmail.com/                  # ê³„ì •
â”‚   â”‚   â”œâ”€â”€ 09-30-15_pause/              # ì‹œê°„_ì‘ì—…ì¢…ë¥˜
â”‚   â”‚   â”‚   â”œâ”€â”€ log.txt                  # ì‚¬ëŒìš© ë¡œê·¸
â”‚   â”‚   â”‚   â”œâ”€â”€ meta.json                # í”„ë¡œê·¸ë¨ìš© ë©”íƒ€ë°ì´í„°
â”‚   â”‚   â”‚   â”œâ”€â”€ 01_navigation.png        # ë‹¨ê³„ë³„ ìŠ¤í¬ë¦°ìƒ·
â”‚   â”‚   â”‚   â”œâ”€â”€ 03_button.png
â”‚   â”‚   â”‚   â””â”€â”€ 05_success.png
â”‚   â”‚   â””â”€â”€ 14-20-30_resume/
â”‚   â”‚       â”œâ”€â”€ log.txt
â”‚   â”‚       â”œâ”€â”€ meta.json
â”‚   â”‚       â””â”€â”€ 05_success.png
â”‚   â””â”€â”€ jane@gmail.com/
â”‚       â””â”€â”€ 10-45-00_pause/
â”‚           â”œâ”€â”€ log.txt
â”‚           â”œâ”€â”€ meta.json
â”‚           â””â”€â”€ error_timeout.png
```

### ë‹¨ê³„ ë²ˆí˜¸ ê·œì¹™

| ë²ˆí˜¸ | ë‹¨ê³„ | ì„¤ëª… |
|------|------|------|
| 01 | navigation | í˜ì´ì§€ ì´ë™ |
| 02 | language | ì–¸ì–´ ê°ì§€ |
| 03 | button | ë²„íŠ¼ í´ë¦­ |
| 04 | popup | íŒì—… í™•ì¸ |
| 05 | success | ìµœì¢… ì„±ê³µ |
| error_ | (ì ‘ë‘ì‚¬) | ì˜¤ë¥˜ ì‹œì  |

---

## 3. SessionLogService API

```javascript
// src/services/SessionLogService.js

class SessionLogService {
  constructor({ logger, debugMode = false }) {
    this.logger = logger;
    this.debugMode = debugMode;
    this.baseDir = 'logs/screenshots';
    this.session = null;
  }

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // ì„¸ì…˜ ê´€ë¦¬
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  /**
   * ì‘ì—… ì„¸ì…˜ ì‹œì‘ - í´ë” ìƒì„±
   * @param {string} email - ê³„ì • ì´ë©”ì¼
   * @param {string} action - 'pause' | 'resume'
   * @returns {string} ì„¸ì…˜ í´ë” ê²½ë¡œ
   */
  startSession(email, action) {}

  /**
   * ì„¸ì…˜ ì¢…ë£Œ - meta.json ì €ì¥
   * @param {string} result - 'success' | 'error'
   * @param {Object} details - ì¶”ê°€ ì •ë³´
   */
  endSession(result, details = {}) {}

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // ìŠ¤í¬ë¦°ìƒ· ì´¬ì˜
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  /**
   * ìŠ¤í¬ë¦°ìƒ· ì´¬ì˜
   * @param {Page} page - Puppeteer í˜ì´ì§€
   * @param {string} step - '01_navigation' | '03_button' | 'error_timeout'
   */
  async capture(page, step) {}

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // ë¡œê·¸ ê¸°ë¡
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  /**
   * log.txtì— ë©”ì‹œì§€ ì¶”ê°€
   * @param {string} message - ë¡œê·¸ ë©”ì‹œì§€
   */
  writeLog(message) {}

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // ì •ë¦¬ ê¸°ëŠ¥
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  /**
   * Nì¼ ì´ì „ í´ë” ìë™ ì‚­ì œ
   * @param {number} days - ë³´ê´€ ì¼ìˆ˜ (ê¸°ë³¸ 3ì¼)
   */
  async cleanup(days = 3) {}

  /**
   * ì „ì²´ ìŠ¤í¬ë¦°ìƒ· í´ë” ë¹„ìš°ê¸°
   */
  async clearAll() {}

  /**
   * ì„¸ì…˜ í†µê³„ ì¡°íšŒ
   */
  async getStats() {}
}
```

---

## 4. log.txt í¬ë§·

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“‹ ì‘ì—… ì„¸ì…˜: pause | john@gmail.com
   ì‹œì‘: 2025-12-28 09:30:15
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[09:30:15] ğŸš€ ì„¸ì…˜ ì‹œì‘
[09:30:18] ğŸ“¸ 01_navigation.png - í˜ì´ì§€ ì´ë™ ì™„ë£Œ
[09:30:22] ğŸŒ ì–¸ì–´ ê°ì§€: ko (í•œêµ­ì–´)
[09:30:25] ğŸ“¸ 03_button.png - ë²„íŠ¼ í´ë¦­ ì „
[09:30:28] âœ… ë²„íŠ¼ í´ë¦­ ì„±ê³µ: "ë©¤ë²„ì‹­ ì¼ì‹œì¤‘ì§€"
[09:30:32] ğŸ“¸ 04_popup.png - íŒì—… í‘œì‹œ
[09:30:35] âœ… íŒì—… í™•ì¸ í´ë¦­
[09:30:38] ğŸ“¸ 05_success.png - ìµœì¢… ê²°ê³¼

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ… ì‘ì—… ì™„ë£Œ: success
   ì¢…ë£Œ: 2025-12-28 09:30:38
   ì†Œìš”: 23ì´ˆ
   ë‹¤ìŒ ê²°ì œì¼: 2025-01-15
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### ì—ëŸ¬ ë°œìƒ ì‹œ

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âŒ ì‘ì—… ì‹¤íŒ¨: timeout
   ì¢…ë£Œ: 2025-12-28 09:31:45
   ì†Œìš”: 90ì´ˆ
   ì›ì¸: ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## 5. meta.json í¬ë§·

```json
{
  "session": {
    "id": "20251228-093015-pause",
    "email": "john@gmail.com",
    "action": "pause",
    "startTime": "2025-12-28T09:30:15.000Z",
    "endTime": "2025-12-28T09:30:38.000Z",
    "duration": 23
  },
  "result": {
    "status": "success",
    "nextBillingDate": "2025-01-15",
    "error": null
  },
  "environment": {
    "language": "ko",
    "profileId": "k8dj2nf1"
  },
  "screenshots": [
    { "file": "01_navigation.png", "step": "navigation", "time": "09:30:18" },
    { "file": "03_button.png", "step": "button", "time": "09:30:25" },
    { "file": "04_popup.png", "step": "popup", "time": "09:30:32" },
    { "file": "05_success.png", "step": "success", "time": "09:30:38" }
  ],
  "logs": [
    { "time": "09:30:15", "message": "ì„¸ì…˜ ì‹œì‘" },
    { "time": "09:30:18", "message": "í˜ì´ì§€ ì´ë™ ì™„ë£Œ" },
    { "time": "09:30:22", "message": "ì–¸ì–´ ê°ì§€: ko" },
    { "time": "09:30:28", "message": "ë²„íŠ¼ í´ë¦­ ì„±ê³µ" },
    { "time": "09:30:35", "message": "íŒì—… í™•ì¸ í´ë¦­" }
  ]
}
```

### ì—ëŸ¬ ë°œìƒ ì‹œ

```json
{
  "result": {
    "status": "error",
    "error": {
      "type": "timeout",
      "message": "ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ",
      "step": "button"
    }
  }
}
```

---

## 6. UseCase í†µí•© ë°©ë²•

### ë³€ê²½ ì „

```javascript
// í˜„ì¬: ìŠ¤í¬ë¦°ìƒ·ì´ ì—¬ëŸ¬ ê³³ì— ë¶„ì‚°
async captureScreenshot(page, filename, profileId) {
  const screenshotDir = path.join(process.cwd(), 'logs', 'screenshots');
  const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, 19);
  const screenshotPath = path.join(screenshotDir, `${timestamp}_${profileId}_${filename}.png`);
  await page.screenshot({ path: screenshotPath, fullPage: true });
}
```

### ë³€ê²½ í›„

```javascript
// UseCase ìƒì„±ìì— SessionLogService ì£¼ì…
constructor({ sessionLogService, ...others }) {
  this.sessionLogService = sessionLogService;
}

// execute ë©”ì„œë“œ
async execute(profileId, email) {
  this.sessionLogService.startSession(email, 'pause');

  try {
    this.sessionLogService.writeLog('í˜ì´ì§€ ì´ë™ ì‹œì‘');
    await this.navigateToPage(page);
    await this.sessionLogService.capture(page, '01_navigation');

    this.sessionLogService.writeLog(`ì–¸ì–´ ê°ì§€: ${language}`);

    this.sessionLogService.writeLog('ë²„íŠ¼ í´ë¦­');
    await this.sessionLogService.capture(page, '03_button');
    await this.clickButton(page);

    await this.sessionLogService.capture(page, '05_success');
    this.sessionLogService.endSession('success', { nextBillingDate });

  } catch (error) {
    await this.sessionLogService.capture(page, `error_${error.type}`);
    this.sessionLogService.endSession('error', { error: error.message });
    throw error;
  }
}
```

---

## 7. CLI ëª…ë ¹ì–´

### npm ìŠ¤í¬ë¦½íŠ¸

```json
{
  "scripts": {
    "sessions:cleanup": "node scripts/session-cleanup.js",
    "sessions:clear": "node scripts/session-clear.js",
    "sessions:stats": "node scripts/session-stats.js"
  }
}
```

### ì¶œë ¥ ì˜ˆì‹œ

**ìë™ ì •ë¦¬ (cleanup)**:
```
$ npm run sessions:cleanup

ğŸ“¸ ì„¸ì…˜ ë¡œê·¸ ì •ë¦¬ ì‹œì‘ (3ì¼ ì´ì „ ì‚­ì œ)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
[ê²€ìƒ‰] 2025-12-25/
   â””â”€ 15ê°œ ì„¸ì…˜ (ìŠ¤í¬ë¦°ìƒ· 47ê°œ, ë¡œê·¸ 30ê°œ)
[ê²€ìƒ‰] 2025-12-24/
   â””â”€ 8ê°œ ì„¸ì…˜ (ìŠ¤í¬ë¦°ìƒ· 23ê°œ, ë¡œê·¸ 16ê°œ)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ—‘ï¸ ì‚­ì œ ì™„ë£Œ
   ì„¸ì…˜: 23ê°œ
   ìŠ¤í¬ë¦°ìƒ·: 70ê°œ
   ë¡œê·¸: 46ê°œ (log.txt + meta.json)
   ìš©ëŸ‰: 12.5MB
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ… í˜„ì¬ ë³´ê´€ ì¤‘: 2025-12-26 ~ 2025-12-28
```

**ì „ì²´ ë¹„ìš°ê¸° (clearAll)**:
```
$ npm run sessions:clear

âš ï¸  ì „ì²´ ì„¸ì…˜ ë¡œê·¸ë¥¼ ì‚­ì œí•©ë‹ˆë‹¤!
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
í˜„ì¬ ë³´ê´€ ì¤‘:
   ì„¸ì…˜: 52ê°œ
   ìŠ¤í¬ë¦°ìƒ·: 156ê°œ
   ë¡œê·¸: 104ê°œ
   ìš©ëŸ‰: 18.2MB
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? (y/N): y

ğŸ—‘ï¸ ì „ì²´ ì‚­ì œ ì™„ë£Œ
```

**í†µê³„ ë³´ê¸° (stats)**:
```
$ npm run sessions:stats

ğŸ“Š ì„¸ì…˜ ë¡œê·¸ í†µê³„
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ë‚ ì§œ          ì„¸ì…˜    ì„±ê³µ    ì‹¤íŒ¨    ìŠ¤í¬ë¦°ìƒ·   ë¡œê·¸    ìš©ëŸ‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
2025-12-28    23      20      3       68        46     5.2MB
2025-12-27    18      15      3       52        36     4.1MB
2025-12-26    11      10      1       36        22     2.9MB
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
í•©ê³„          52      45      7       156       104    12.2MB
ì„±ê³µë¥ : 86.5%
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## 8. êµ¬í˜„ ìˆœì„œ

### Phase 1: ê¸°ë°˜ êµ¬ì¶•
1. SessionLogService.js ìƒì„±
2. container.js ë“±ë¡
3. ë‹¨ìœ„ í…ŒìŠ¤íŠ¸

### Phase 2: UseCase í†µí•©
1. EnhancedPauseSubscriptionUseCase ì ìš©
2. EnhancedResumeSubscriptionUseCase ì ìš©
3. í†µí•© í…ŒìŠ¤íŠ¸

### Phase 3: CLI/ìŠ¤í¬ë¦½íŠ¸
1. npm ìŠ¤í¬ë¦½íŠ¸ ì¶”ê°€
2. EnterpriseCLI ë©”ë‰´ ì¶”ê°€
3. ì›Œì»¤ ìë™ ì •ë¦¬ ì—°ë™

---

## 9. container.js ë“±ë¡

```javascript
// src/container.js
sessionLogService: asClass(SessionLogService)
  .inject(() => ({
    logger: container.resolve('logger'),
    debugMode: process.env.DEBUG_MODE === 'true'
  }))
  .singleton()
```

---

## 10. ë¡¤ë°± ê³„íš

```bash
# ê° Phase ì™„ë£Œ í›„ commit
git commit -m "feat: SessionLogService ê¸°ë°˜ êµ¬ì¶•"
git commit -m "feat: UseCaseì— SessionLogService í†µí•©"
git commit -m "feat: ì„¸ì…˜ ë¡œê·¸ CLI ëª…ë ¹ì–´ ì¶”ê°€"
```

---

## 11. ë³´ê´€ ì •ì±…

| í•­ëª© | ì„¤ì • |
|------|------|
| ë³´ê´€ ê¸°ê°„ | 3ì¼ |
| ìë™ ì •ë¦¬ | ì›Œì»¤ ì‹œì‘ ì‹œ ë˜ëŠ” ìˆ˜ë™ |
| ì „ì²´ ë¹„ìš°ê¸° | CLI ë©”ë‰´/ìŠ¤í¬ë¦½íŠ¸ |

---

## 12. ìˆ˜ì • ëŒ€ìƒ íŒŒì¼

| íŒŒì¼ | ë³€ê²½ ë‚´ìš© |
|------|-----------|
| `src/services/SessionLogService.js` | ì‹ ê·œ ìƒì„± |
| `src/container.js` | SessionLogService ë“±ë¡ |
| `src/application/usecases/EnhancedPauseSubscriptionUseCase.js` | ì„œë¹„ìŠ¤ ì£¼ì… ë° í˜¸ì¶œ ë³€ê²½ |
| `src/application/usecases/EnhancedResumeSubscriptionUseCase.js` | ë™ì¼ íŒ¨í„´ ì ìš© |
| `src/presentation/cli/EnterpriseCLI.js` | ì„¸ì…˜ ë¡œê·¸ ê´€ë¦¬ ë©”ë‰´ ì¶”ê°€ |
| `scripts/session-cleanup.js` | ì‹ ê·œ ìƒì„± |
| `scripts/session-clear.js` | ì‹ ê·œ ìƒì„± |
| `scripts/session-stats.js` | ì‹ ê·œ ìƒì„± |
| `package.json` | npm ìŠ¤í¬ë¦½íŠ¸ ì¶”ê°€ |
